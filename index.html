<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Special Extra Course</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to override or extend Tailwind */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); /* More vibrant gradient */
            color: white;
            overflow: hidden; /* Prevent scrollbar from gradient */
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            letter-spacing: 1.5px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            color: #fff; /* Ensure heading is white */
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #1a202c; /* Darker color for section titles */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .container {
            background: rgba(255, 255, 255, 0.15); /* Semi-transparent white background */
            backdrop-filter: blur(15px); /* Stronger frosted glass effect */
            border: 1px solid rgba(255, 255, 255, 0.3); /* Subtle border */
            color: #1a202c; /* Dark text for contrast on light background */
            width: 90%;
            max-width: 450px; /* Slightly wider container */
            border-radius: 20px; /* More rounded corners */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4); /* Deeper shadow */
            padding: 40px; /* More padding */
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: fadeIn 1s ease-out; /* Add a fade-in animation */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3); /* Lighter border for tabs */
            margin-bottom: 30px;
        }

        .tabs button {
            background: transparent;
            border: none;
            padding: 12px 20px; /* More padding for tabs */
            font-size: 1.1rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7); /* Lighter color for inactive tabs */
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tabs button.active {
            color: #fff; /* White for active tab */
            border-bottom: 3px solid #fff; /* Stronger active indicator */
            transform: translateY(-2px); /* Slight lift for active tab */
        }

        .tabs button:hover:not(.active) {
            color: #e0f2fe; /* Light blue on hover for inactive */
            transform: translateY(-2px);
        }

        .form-group {
            display: none;
            margin-bottom: 20px;
        }

        .form-group.active {
            display: block;
        }

        /* Input field styling */
        .input-wrapper {
            position: relative;
            margin-bottom: 15px; /* Space for error message */
        }

        .input-wrapper input {
            width: 100%;
            padding: 12px 15px;
            font-size: 1rem;
            border: 1px solid #cbd5e0;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            color: #2d3748;
            transition: all 0.3s ease;
            outline: none;
        }

        .input-wrapper input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
            background-color: #fff;
        }

        .error-message {
            color: #ef4444; /* Tailwind red-500 */
            font-size: 0.85rem;
            text-align: left;
            margin-top: 5px;
            height: 18px; /* Reserve space to prevent layout shift */
            display: block;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .error-message.active {
            opacity: 1;
        }

        /* Show password toggle */
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #4a5568; /* Tailwind gray-700 */
            font-size: 1.2rem;
            transition: color 0.2s;
        }

        .password-toggle:hover {
            color: #2d3748; /* Tailwind gray-900 */
        }


        .form-group button {
            width: 100%;
            padding: 14px;
            font-size: 1.1rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 114, 255, 0.4);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .form-group button:hover:not(:disabled) { /* Only hover if not disabled */
            background: linear-gradient(45deg, #0072ff, #00c6ff);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 114, 255, 0.6);
        }

        .form-group button:active:not(:disabled) { /* Only active if not disabled */
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(0, 114, 255, 0.3);
        }

        .form-group button:disabled {
            background: #a0aec0; /* Tailwind gray-400 */
            cursor: not-allowed;
            box-shadow: none;
        }


        #status {
            margin-top: 25px;
            font-size: 1rem;
            font-weight: 500;
            color: #2d3748;
        }

        a {
            color: #007bff;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        a:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        
        /* Admin button specific style */
        #admin-dashboard-button {
            background-color: #4CAF50; /* Green */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 20px;
            transition: background-color 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        #admin-dashboard-button:hover {
            background-color: #45a049;
        }


        /* Responsive adjustments */
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
                margin-bottom: 20px;
            }
            h2 {
                font-size: 1.5rem;
                margin-bottom: 20px;
            }
            .container {
                padding: 30px;
                border-radius: 15px;
            }
            .tabs button {
                padding: 10px 15px;
                font-size: 1rem;
            }
            .input-wrapper input {
                padding: 10px 12px;
                font-size: 0.95rem;
            }
            .form-group button {
                padding: 12px;
                font-size: 1rem;
            }
        }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import {
            getFirestore,
            doc,
            setDoc
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        // Reverted to original hardcoded Firebase config as requested
        const firebaseConfig = {
            apiKey: "AIzaSyA-EoipgOVg9prfbYJ5VoYjA8rqk-RDW5U",
            authDomain: "extra-course-d02c2.firebaseapp.com",
            projectId: "extra-course-d02c2",
            storageBucket: "extra-course-d02c2.firebasestorage.app",
            messagingSenderId: "40624772967",
            appId: "1:40624772967:web:d022eb7b2c2f4785a641c2",
            measurementId: "G-YNRJKV8T45",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.addEventListener("DOMContentLoaded", () => {
            const signupButton = document.getElementById("signup-button");
            const signinButton = document.getElementById("signin-button");
            const signupTab = document.getElementById("signup-tab");
            const signinTab = document.getElementById("signin-tab");
            const signupForm = document.getElementById("signup-form");
            const signinForm = document.getElementById("signin-form");
            const forgotPasswordLink = document.getElementById("forgot-password");
            const statusDiv = document.getElementById("status");
            const adminDashboardButton = document.getElementById("admin-dashboard-button"); // Get the new button

            // Signup form elements
            const signupNameInput = document.getElementById("signup-name");
            const signupEmailInput = document.getElementById("signup-email");
            const signupPasswordInput = document.getElementById("signup-password");
            const signupConfirmPasswordInput = document.getElementById("signup-confirm-password");

            // Signin form elements
            const signinEmailInput = document.getElementById("signin-email");
            const signinPasswordInput = document.getElementById("signin-password");

            // Error message elements for signup
            const signupNameError = document.getElementById("signup-name-error");
            const signupEmailError = document.getElementById("signup-email-error");
            const signupPasswordError = document.getElementById("signup-password-error");
            const signupConfirmPasswordError = document.getElementById("signup-confirm-password-error");

            // Error message elements for signin
            const signinEmailError = document.getElementById("signin-email-error");
            const signinPasswordError = document.getElementById("signin-password-error");

            // Moved emailRegex declaration to the top of DOMContentLoaded
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;


            // Set initial active tab
            signupForm.classList.add("active");
            signupTab.classList.add("active");
            validateSignupForm(); // Validate initially to disable button

            signupTab.addEventListener("click", () => {
                signupForm.classList.add("active");
                signinForm.classList.remove("active");
                signupTab.classList.add("active");
                signinTab.classList.remove("active");
                statusDiv.innerText = "";
                resetFormValidation(signinForm); // Clear signin errors
                validateSignupForm(); // Re-validate signup form
            });

            signinTab.addEventListener("click", () => {
                signinForm.classList.add("active");
                signupForm.classList.remove("active");
                signinTab.classList.add("active");
                signupTab.classList.remove("active");
                statusDiv.innerText = "";
                resetFormValidation(signupForm); // Clear signup errors
                validateSigninForm(); // Re-validate signin form
            });

            // --- Validation Functions ---
            function showError(element, message) {
                element.innerText = message;
                element.classList.add("active");
            }

            function hideError(element) {
                element.innerText = "";
                element.classList.remove("active");
            }

            function validateEmail(email) {
                return emailRegex.test(email);
            }

            function validatePassword(password) {
                return password.length >= 6; // Minimum 6 characters
            }

            function validateSignupForm() {
                let isValid = true;

                // Name validation
                if (signupNameInput.value.trim() === '') {
                    showError(signupNameError, "Name cannot be empty.");
                    isValid = false;
                } else {
                    hideError(signupNameError);
                }

                // Email validation
                if (!validateEmail(signupEmailInput.value)) {
                    showError(signupEmailError, "Enter a valid email.");
                    isValid = false;
                } else {
                    hideError(signupEmailError);
                }

                // Password validation
                if (!validatePassword(signupPasswordInput.value)) {
                    showError(signupPasswordError, "Min 6 characters.");
                    isValid = false;
                } else {
                    hideError(signupPasswordError);
                }

                // Confirm password validation
                if (signupConfirmPasswordInput.value !== signupPasswordInput.value) {
                    showError(signupConfirmPasswordError, "Passwords do not match.");
                    isValid = false;
                } else {
                    hideError(signupConfirmPasswordError);
                }

                signupButton.disabled = !isValid;
                return isValid;
            }

            function validateSigninForm() {
                let isValid = true;

                // Email validation
                if (!validateEmail(signinEmailInput.value)) {
                    showError(signinEmailError, "Enter a valid email.");
                    isValid = false;
                } else {
                    hideError(signinEmailError);
                }

                // Password validation (can be basic for sign-in)
                if (signinPasswordInput.value.length === 0) {
                    showError(signinPasswordError, "Password cannot be empty.");
                    isValid = false;
                } else {
                    hideError(signinPasswordError);
                }

                signinButton.disabled = !isValid;
                return isValid;
            }

            function resetFormValidation(formElement) {
                const errorMessages = formElement.querySelectorAll('.error-message');
                errorMessages.forEach(errorSpan => hideError(errorSpan));
                const buttons = formElement.querySelectorAll('button');
                // Only re-enable buttons if form is valid after reset
                if (formElement.id === 'signup-form') {
                    validateSignupForm();
                } else if (formElement.id === 'signin-form') {
                    validateSigninForm();
                }
            }

            // Add event listeners for real-time validation on signup form
            signupNameInput.addEventListener("input", validateSignupForm);
            signupEmailInput.addEventListener("input", validateSignupForm);
            signupPasswordInput.addEventListener("input", validateSignupForm);
            signupConfirmPasswordInput.addEventListener("input", validateSignupForm);
            signupConfirmPasswordInput.addEventListener("blur", validateSignupForm); // Check on blur too for confirm pass

            // Add event listeners for real-time validation on signin form
            signinEmailInput.addEventListener("input", validateSigninForm);
            signinPasswordInput.addEventListener("input", validateSigninForm);


            // --- Password Toggle Functionality ---
            function setupPasswordToggle(inputId, toggleId) {
                const passwordInput = document.getElementById(inputId);
                const toggleIcon = document.getElementById(toggleId);

                if (passwordInput && toggleIcon) {
                    toggleIcon.addEventListener("click", () => {
                        if (passwordInput.type === "password") {
                            passwordInput.type = "text";
                            toggleIcon.innerText = "🚫"; // Change to slash-eye icon
                        } else {
                            passwordInput.type = "password";
                            toggleIcon.innerText = "👁️"; // Change back to eye icon
                        }
                    });
                }
            }

            // Setup toggles for both signup and signin passwords
            setupPasswordToggle("signup-password", "signup-password-toggle");
            setupPasswordToggle("signup-confirm-password", "signup-confirm-password-toggle");
            setupPasswordToggle("signin-password", "signin-password-toggle");


            // --- Firebase Operations (reverted to original hardcoded setup) ---
            signupButton.addEventListener("click", async () => {
                if (!validateSignupForm()) {
                    statusDiv.innerText = "Please fix the errors in the form.";
                    return;
                }

                statusDiv.innerText = "Signing up...";
                signupButton.disabled = true; // Disable button during API call
                const email = signupEmailInput.value;
                const password = signupPasswordInput.value;
                const name = signupNameInput.value;

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    // Reverted Firestore path to "users" collection
                    await setDoc(doc(db, "users", user.uid), { name: name || "Anonymous", role: "Student", email: user.email });

                    statusDiv.innerText = `Sign Up Successful! Welcome, ${user.email}`;
                    // Redirect to user dashboard after signup
                    setTimeout(() => window.location.href = "userdashboard.html", 2000);
                } catch (error) {
                    statusDiv.innerText = `Error: ${error.message}`;
                    console.error("Sign up error:", error);
                } finally {
                    signupButton.disabled = false; // Re-enable button after API call completes/fails
                }
            });

            signinButton.addEventListener("click", async () => {
                if (!validateSigninForm()) {
                    statusDiv.innerText = "Please fix the errors in the form.";
                    return;
                }

                statusDiv.innerText = "Signing in...";
                signinButton.disabled = true; // Disable button during API call
                const email = signinEmailInput.value;
                const password = signinPasswordInput.value;

                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;

                    statusDiv.innerText = `Sign In Successful! Welcome back, ${user.email}`;
                    // Redirect to user dashboard after signin
                    setTimeout(() => window.location.href = "user-dashboard.html", 2000);
                } catch (error) {
                    statusDiv.innerText = `Error: ${error.message}`;
                    console.error("Sign in error:", error);
                } finally {
                    signinButton.disabled = false; // Re-enable button after API call completes/fails
                }
            });

            forgotPasswordLink.addEventListener("click", async (e) => {
                e.preventDefault();
                const email = signinEmailInput.value;

                if (!validateEmail(email)) {
                    statusDiv.innerText = "Please enter a valid email in the Sign In tab to reset password.";
                    return;
                }

                statusDiv.innerText = "Sending reset email...";
                try {
                    await sendPasswordResetEmail(auth, email);
                    statusDiv.innerText = `Password reset email sent to ${email}. Please check your inbox.`;
                } catch (error) {
                    statusDiv.innerText = `Error: ${error.message}`;
                    console.error("Password reset error:", error);
                }
            });

            // Admin Dashboard Button Event Listener
            adminDashboardButton.addEventListener("click", () => {
                window.location.href = "admin.html"; // Redirect to admin.html
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Special Extra Course</h1>
        <div class="tabs">
            <button id="signup-tab">Sign Up</button>
            <button id="signin-tab">Sign In</button>
        </div>
        <div id="signup-form" class="form-group">
            <h2>Sign Up</h2>
            <div class="input-wrapper">
                <input type="text" id="signup-name" placeholder="Name" required>
                <span id="signup-name-error" class="error-message"></span>
            </div>
            <div class="input-wrapper">
                <input type="email" id="signup-email" placeholder="Email" required>
                <span id="signup-email-error" class="error-message"></span>
            </div>
            <div class="input-wrapper">
                <input type="password" id="signup-password" placeholder="Password" required>
                <span id="signup-password-toggle" class="password-toggle">👁️</span>
                <span id="signup-password-error" class="error-message"></span>
            </div>
            <div class="input-wrapper">
                <input type="password" id="signup-confirm-password" placeholder="Confirm Password" required>
                <span id="signup-confirm-password-toggle" class="password-toggle">👁️</span>
                <span id="signup-confirm-password-error" class="error-message"></span>
            </div>
            <button id="signup-button">Sign Up</button>
        </div>
        <div id="signin-form" class="form-group">
            <h2>Sign In</h2>
            <div class="input-wrapper">
                <input type="email" id="signin-email" placeholder="Email" required>
                <span id="signin-email-error" class="error-message"></span>
            </div>
            <div class="input-wrapper">
                <input type="password" id="signin-password" placeholder="Password" required>
                <span id="signin-password-toggle" class="password-toggle">👁️</span>
                <span id="signin-password-error" class="error-message"></span>
            </div>
            <button id="signin-button">Sign In</button>
            <p style="text-align: center; margin-top: 15px;">
                <a href="#" id="forgot-password">Forgot Password?</a>
            </p>
        </div>
        <div id="status"></div>
        <button id="admin-dashboard-button">Go to Admin Dashboard</button>
    </div>
</body>
</html>
